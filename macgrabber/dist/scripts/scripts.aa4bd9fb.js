"use strict";angular.module("macgrabberApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngCsv"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/inventory.html",controller:"InventoryCtrl"}).when("/onboard",{templateUrl:"views/onboard.html",controller:"OnboardCtrl"}).when("/batchoperation",{templateUrl:"views/batchoperation.html",controller:"BatchoperationCtrl"}).when("/tagmanager",{templateUrl:"views/tagmanager.html",controller:"TagmanagerCtrl"}).otherwise({redirectTo:"/"})}]).constant("ENDPOINT_URI","http://10.33.15.150:3000/api/"),angular.module("macgrabberApp").controller("InventoryCtrl",["$scope","ComputerModel","TagModel",function(a,b,c){a.tags=[],a.computers=[],a.selectedTag="",a.loading=!0,console.log(a.loading),c.all().then(function(b){a.tags=b.data,a.updateTagNames(),a.tagDropdown=a.tags[0]}),b.all().then(function(b){a.computers=b.data,a.updateTagNames(),a.loading=!1,console.log(a.loading)}),a.isTagActive=function(b){return b._id===a.selectedTag._id},a.resetSelected=function(){a.computersCheckbox=!1;for(var b=0;b<a.computers.length;b++)a.computers[b].selected=!1},a.updateTagNames=function(){a.computers.forEach(function(b){b.tagNames=[],b.tags.forEach(function(c){b.tagNames.push(a.getTagName(c))})})},a.selectAllComputers=function(b){for(var c=0;c<a.computerResults.length;c++)a.computerResults[c].selected=b},a.setTag=function(b){a.selectedTag=b,a.resetSelected()},a.getTagName=function(b){for(var c=0;c<a.tags.length;c++){var d=a.tags[c];if(d._id===b)return d.name}return""},a.getTagByID=function(b){for(var c=0;c<a.tags.length;c++){var d=a.tags[c];if(d._id===b)return d}return-1},a.deleteSelected=function(){for(var d=0;d<a.computerResults.length;d++){var e=a.computerResults[d];if(e.selected){for(var f=0;f<e.tags.length;f++){var g=a.getTagByID(e.tags[f]);if(-1!==g){var h=g.computers.indexOf(e._id);h>-1&&(g.computers.splice(h,1),c.update(g._id,g))}}b.destroy(e._id);var i=a.computers.indexOf(e);i>-1&&a.computers.splice(i,1)}}a.resetSelected()},a.getCSVArray=function(){for(var b=[],c=0;c<a.computerResults.length;c++){var d=a.computerResults[c];if(d.selected){var e=d.wirelessMAC;e=e.replace(/:/g,""),e=e.toLowerCase(),b.push({computerName:d.name,wirelessMAC:e})}}return b},a.addTagToSelected=function(){if(a.tagDropdown){for(var d=0;d<a.computerResults.length;d++){var e=a.computerResults[d];e.selected&&(e.tags.push(a.tagDropdown._id),b.update(e._id,e),a.tagDropdown.computers.push(e._id),c.update(a.tagDropdown._id,a.tagDropdown))}a.resetSelected(),a.updateTagNames()}},a.removeTagFromSelected=function(){if(a.tagDropdown){for(var d=0;d<a.computerResults.length;d++){var e=a.computerResults[d];if(e.selected){var f=e.tags.indexOf(a.tagDropdown._id);f>-1&&(e.tags.splice(f,1),b.update(e._id,e)),f=a.tagDropdown.computers.indexOf(e._id),f>-1&&(a.tagDropdown.computers.splice(f,1),c.update(a.tagDropdown._id,a.tagDropdown))}}a.resetSelected(),a.updateTagNames()}}}]),angular.module("macgrabberApp").service("ComputerModel",["$http","$location",function(a,b){function c(){return e+g}function d(a){return c(g)+a}var e=b.protocol()+"://"+b.host()+":3000/api/",f=this,g="computers/";f.all=function(){return a.get(c())},f.fetch=function(b){return a.get(d(b))},f.create=function(b){return a.post(c(),b)},f.update=function(b,c){return a.put(d(b),c)},f.destroy=function(b){return a["delete"](d(b))}}]),angular.module("macgrabberApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),angular.module("macgrabberApp").service("TagModel",["$http","$location",function(a,b){function c(){return e+g}function d(a){return c(g)+a}var e=b.protocol()+"://"+b.host()+":3000/api/",f=this,g="tags/";f.all=function(){return a.get(c())},f.fetch=function(b){return a.get(d(b))},f.create=function(b){return a.post(c(),b)},f.update=function(b,c){return a.put(d(b),c)},f.destroy=function(b){return a["delete"](d(b))}}]),angular.module("macgrabberApp").controller("OnboardCtrl",["$scope","ComputerModel","TagModel",function(a,b,c){b.all().then(function(b){a.computers=b.data}),a.selectedTag={name:"No Tag",_id:-1},c.all().then(function(b){a.tags=b.data,a.tags.splice(0,0,{name:"No Tag",_id:-1}),a.selectedTag=a.tags[0]}),a.selectAllComputers=function(b){for(var c=0;c<a.computerResults.length;c++)a.computerResults[c].selected=b},a.resetSelected=function(){a.computersCheckbox=!1;for(var b=0;b<a.computers.length;b++)a.computers[b].selected=!1},a.onBoard=function(){for(var d=0;d<a.computers.length;d++){var e=a.computers[d];e.selected&&(-1!==a.selectedTag._id&&-1===e.tags.indexOf(a.selectedTag._id)&&(a.selectedTag.computers.push(e._id),e.tags.push(a.selectedTag._id)),e.onBoard=!0,b.update(e._id,e))}-1!==a.selectedTag._id&&c.update(a.selectedTag._id,a.selectedTag).then(function(b){a.selectedTag=b.data}),a.resetSelected()}}]),angular.module("macgrabberApp").filter("filterByTag",function(){return function(a,b){if(!b||""===b)return a;var c=[];return(a||[]).forEach(function(a){b&&a.tags.indexOf(b._id)>-1&&c.push(a)}),c}}),angular.module("macgrabberApp").controller("BatchoperationCtrl",["$scope","TagModel","ComputerModel",function(a,b,c){a.operations=[{name:"Add Tag",id:0},{name:"Remove Tag",id:1},{name:"Delete",id:2}],a.selectedOperation=a.operations[0],b.all().then(function(b){a.tags=b.data,a.selectedTag=a.tags[0]}),c.all().then(function(b){a.computers=b.data}),a.commitOperation=function(){var d=a.serialNumbers.split("\n");console.log(d),d.forEach(function(d){(a.computers||[]).forEach(function(e){if(e.onBoard&&e.serialNumber===d)if(0===a.selectedOperation.id)console.log(a.selectedTag),-1===e.tags.indexOf(a.selectedTag._id)&&(console.log(a.selectedTag),e.tags.push(a.selectedTag._id),c.update(e._id,e),a.selectedTag.computers.push(e._id),b.update(a.selectedTag._id,a.selectedTag));else if(1===a.selectedOperation.id){var f=a.selectedTag.computers.indexOf(e._id);f>-1&&(a.selectedTag.computers.splice(f,1),b.update(a.selectedTag._id,a.selectedTag)),f=e.tags.indexOf(a.selectedTag._id),f>-1&&(e.tags.splice(f,1),c.update(e._id,e))}else if(2===a.selectedOperation.id){var g=a.selectedTag.computers.indexOf(e._id);g>-1&&(a.selectedTag.computers.splice(g,1),b.update(a.selectedTag._id,a.selectedTag)),c.destroy(e._id),g=a.computers.indexOf(e),g>-1&&a.computers.splice(g,1)}})}),a.serialNumbers=""}}]),angular.module("macgrabberApp").controller("TagmanagerCtrl",["$scope","TagModel","ComputerModel",function(a,b,c){b.all().then(function(b){a.tags=b.data,a.tags.forEach(function(a){a.editing=!1})}),c.all().then(function(b){a.computers=b.data}),a.operations=[{name:"Remove Tag(s)",id:0},{name:"Remove All Computers From Tag(s)",id:1}],a.selectedOperation=a.operations[0],a.selectAllTags=function(b){a.tagResults.forEach(function(a){a.selected=b})},a.resetSelected=function(){a.tagsCheckbox=!1;for(var b=0;b<a.tags.length;b++)a.tags[b].selected=!1},a.commitOperation=function(){a.tagResults.forEach(function(d){if(d.selected)if(a.computers.forEach(function(a){var b=a.tags.indexOf(d._id);b>-1&&(a.tags.splice(b,1),c.update(a._id,a))}),0===a.selectedOperation.id){b.destroy(d._id);var e=a.tags.indexOf(d);e>-1&&a.tags.splice(e,1)}else 1===a.selectedOperation.id&&(d.computers=[],b.update(d._id,d))}),a.resetSelected()},a.newTag=function(){var c={name:a.newTagName,computers:[]};b.create(c).then(function(b){a.tags.push(b.data),a.newTagName=""})},a.editTag=function(a){a.editing=!0},a.saveTag=function(a){b.update(a._id,a),a.editing=!1},a.cancelEdit=function(a){a.editing=!1},a.isEditing=function(a){return a.editing}}]);